From 62e12bfe0295e2b621252c3271b98ba94e9d1fe8 Mon Sep 17 00:00:00 2001
From: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Date: Thu, 26 May 2022 10:05:20 +0300
Subject: [PATCH] s32cc: Increase reserved mem and EP BAR 2 to 100MB

Issue: ALB-5740

Signed-off-by: Ionut Vicovan <Ionut.Vicovan@nxp.com>
Signed-off-by: Ciprian Costea <ciprianmarian.costea@nxp.com>
---
 arch/arm64/boot/dts/freescale/s32cc.dtsi | 4 ++--
 drivers/pci/controller/dwc/pci-s32gen1.c | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/s32cc.dtsi b/arch/arm64/boot/dts/freescale/s32cc.dtsi
index fdea5162e26d..40a1762045e6 100644
--- a/arch/arm64/boot/dts/freescale/s32cc.dtsi
+++ b/arch/arm64/boot/dts/freescale/s32cc.dtsi
@@ -55,10 +55,10 @@ reserved-memory  {
 		#size-cells = <2>;
 		ranges;
 
-		/* 4Mb shared memory for PCIe shared mem transfers, EP mode */
+		/* 100Mb shared memory for PCIe shared mem transfers, EP mode */
 		pci_shared_memory0: shm@c0000000 {
 			compatible = "nxp,s32cc-shm";
-			reg = <0x0 0xc0000000 0x0 0x400000>;    /* 4 MB */
+			reg = <0x0 0xc0000000 0x0 0x6400000>;    /* 100 MB */
 			no-map;
 		};
 
diff --git a/drivers/pci/controller/dwc/pci-s32gen1.c b/drivers/pci/controller/dwc/pci-s32gen1.c
index 1ff774d61d6e..70304072ff2f 100644
--- a/drivers/pci/controller/dwc/pci-s32gen1.c
+++ b/drivers/pci/controller/dwc/pci-s32gen1.c
@@ -78,7 +78,7 @@
 #define PCIE_EP_BAR1_ADDR		(PCIE_EP_BAR0_ADDR + PCIE_EP_BAR0_SIZE)
 #define PCIE_EP_BAR1_SIZE		0
 #define PCIE_EP_BAR2_ADDR		(PCIE_EP_BAR1_ADDR + PCIE_EP_BAR1_SIZE)
-#define PCIE_EP_BAR2_SIZE		(4 * SZ_1M)
+#define PCIE_EP_BAR2_SIZE		(100 * SZ_1M)
 #define PCIE_EP_BAR3_ADDR		(PCIE_EP_BAR2_ADDR + PCIE_EP_BAR2_SIZE)
 #define PCIE_EP_BAR3_SIZE		0
 #define PCIE_EP_BAR4_ADDR		(PCIE_EP_BAR3_ADDR + PCIE_EP_BAR3_SIZE)
-- 
2.25.1

