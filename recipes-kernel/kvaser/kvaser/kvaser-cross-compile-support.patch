From ed6160a7ba5ba474b097e75ca6d0c96035969d60 Mon Sep 17 00:00:00 2001
From: Vicovan Ionut-Valentin <Ionut.Vicovan@nxp.com>
Date: Thu, 7 Dec 2017 18:10:16 +0200
Subject: [PATCH 1/2] kvaser: cross compile support

Signed-off-by: Vicovan Ionut-Valentin <Ionut.Vicovan@nxp.com>
---
 canlib/examples/Makefile | 2 +-
 common/VCanOsIf.c        | 2 +-
 common/objbuf.c          | 4 ++--
 config.mak               | 2 +-
 4 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/canlib/examples/Makefile b/canlib/examples/Makefile
index 5fca34e..71f260a 100644
--- a/canlib/examples/Makefile
+++ b/canlib/examples/Makefile
@@ -52,7 +52,7 @@
 #  ---------------------------------------------------------------------------
 # 
 
-CC = gcc
+CC ?= gcc
 CFLAGS = -Wall -O2  -D_REENTRANT $(XTRA_CFLAGS) -I../../include
 LDFLAGS = -L..
 LDLIBS = -lcanlib -lpthread
diff --git a/common/VCanOsIf.c b/common/VCanOsIf.c
index 9b346a5..8fc2e54 100644
--- a/common/VCanOsIf.c
+++ b/common/VCanOsIf.c
@@ -312,7 +312,7 @@ int vCanDispatchEvent (VCanChanData *chd, VCAN_EVENT *e)
                                               msg_flags)) != 0)) {
         // This is something that matched the code/mask for at least one buffer,
         // and it's *not* a TXRQ or a TXACK.
-#ifdef __arm__
+#if (defined(__arm__) || defined(__aarch64__))
         unsigned int rd;
         unsigned int new_rd;
         do {
diff --git a/common/objbuf.c b/common/objbuf.c
index 45caf54..d796788 100644
--- a/common/objbuf.c
+++ b/common/objbuf.c
@@ -116,7 +116,7 @@ static void objbuf_write_all (OS_IF_TASK_QUEUE_HANDLE *work)
   CAN_MSG          *bufMsgPtr;
   int              queuePos;
 
-#ifdef __arm__
+#if (defined(__arm__) || defined(__aarch64__))
   unsigned int rd;
   unsigned int new_rd;
 #endif
@@ -177,7 +177,7 @@ static void objbuf_write_all (OS_IF_TASK_QUEUE_HANDLE *work)
 
     done_mask |= (1 << i);
   }
-#ifdef __arm__
+#if (defined(__arm__) || defined(__aarch64__))
   do {
     rd = atomic_read(&fileNodePtr->objbufActive);
     new_rd = rd & ~done_mask;
diff --git a/config.mak b/config.mak
index 1c6138a..cbcc40c 100644
--- a/config.mak
+++ b/config.mak
@@ -55,7 +55,7 @@ KV_NDEBUGFLAGS = -D_DEBUG=0 -DDEBUG=0
 
 #----------------------------------------
 # Select kernel source folder
-KERNEL_SOURCE_DIR=/lib/modules/`uname -r`/build
+KERNEL_SOURCE_DIR?=/lib/modules/`uname -r`/build
 KV_KERNEL_SRC_DIR:=$(KERNEL_SOURCE_DIR)
 
 #---------------------------------------------------------------------------
diff --git a/common/osif_functions_user.c b/common/osif_functions_user.c
index 746889a..eee95c1 100644
--- a/common/osif_functions_user.c
+++ b/common/osif_functions_user.c
@@ -54,7 +54,6 @@
 
 #   include <sys/ioctl.h>
 #   include <unistd.h>
-#   include <sys/io.h>
 #   include <fcntl.h>
 
 
-- 
2.7.4
