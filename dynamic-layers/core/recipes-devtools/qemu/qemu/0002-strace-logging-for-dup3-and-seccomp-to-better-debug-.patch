From f3ac5a3ed4184f41c902b27e9f77549e1369e689 Mon Sep 17 00:00:00 2001
From: Heinz Wrobel <Heinz.Wrobel@nxp.com>
Date: Sun, 14 Oct 2018 20:52:22 +0200
Subject: [PATCH 2/3] strace logging for dup3 and seccomp to better debug
 client behavior

Signed-off-by: Heinz Wrobel <Heinz.Wrobel@nxp.com>
---
 linux-user/strace.c    | 14 ++++++++++++++
 linux-user/strace.list |  6 ++++++
 2 files changed, 20 insertions(+)

diff --git a/linux-user/strace.c b/linux-user/strace.c
index d821d16..48b7ca4 100644
--- a/linux-user/strace.c
+++ b/linux-user/strace.c
@@ -2580,6 +2580,20 @@ print_tgkill(const struct syscallname *name,
 }
 #endif
 
+#ifdef TARGET_NR_seccomp
+static void
+print_seccomp(const struct syscallname *name,
+    abi_long arg0, abi_long arg1, abi_long arg2,
+    abi_long arg3, abi_long arg4, abi_long arg5)
+{
+    print_syscall_prologue(name);
+    print_raw_param("%d", arg0, 0);
+    print_raw_param("%d", arg1, 0);
+    print_pointer(arg2, 1);
+    print_syscall_epilogue(name);
+}
+#endif
+
 /*
  * An array of all of the syscalls we know about
  */
diff --git a/linux-user/strace.list b/linux-user/strace.list
index a91e33f..3e99d80 100644
--- a/linux-user/strace.list
+++ b/linux-user/strace.list
@@ -121,6 +121,9 @@
 #ifdef TARGET_NR_dup2
 { TARGET_NR_dup2, "dup2" , NULL, NULL, NULL },
 #endif
+#ifdef TARGET_NR_dup3
+{ TARGET_NR_dup3, "dup3" , "%s(%d,%d,%#x)", NULL, NULL },
+#endif
 #ifdef TARGET_NR_epoll_create
 { TARGET_NR_epoll_create, "epoll_create" , NULL, NULL, NULL },
 #endif
@@ -1124,6 +1127,9 @@
 #ifdef TARGET_NR_renameat2
 { TARGET_NR_renameat2, "renameat2" , NULL, NULL, NULL },
 #endif
+#ifdef TARGET_NR_seccomp
+{ TARGET_NR_seccomp, "seccomp" , NULL, print_seccomp, NULL },
+#endif
 #ifdef TARGET_NR_request_key
 { TARGET_NR_request_key, "request_key" , NULL, NULL, NULL },
 #endif
-- 
1.8.3.1

